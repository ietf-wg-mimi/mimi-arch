<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>An Architecture for More Instant Messaging Interoperability (MIMI)</title>
<meta content="Richard L. Barnes" name="author">
<meta content="
       The More Instant Messaging Interoperability (MIMI) working group is defining a
suite of protocols that allow messaging providers to interoperate with one
another.  This document lays out an overall architecture enumerating the MIMI
protocols and how they work together to enable an overall messaging experience. 
    " name="description">
<meta content="xml2rfc 3.20.0" name="generator">
<meta content="messaging" name="keyword">
<meta content="end-to-end security" name="keyword">
<meta content="draft-barnes-mimi-arch-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.20.0
    Python 3.11.8
    ConfigArgParse 1.7
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 4.2.0
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.31.0
    setuptools 68.2.2
    six 1.16.0
    wcwidth 0.2.13
-->
<link href="draft-barnes-mimi-arch.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">MIMI Architecture</td>
<td class="right">March 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Barnes</td>
<td class="center">Expires 5 September 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">More Instant Messaging Interoperability</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-barnes-mimi-arch-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-03-04" class="published">4 March 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-09-05">5 September 2024</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">R. L. Barnes</div>
<div class="org">Cisco</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">An Architecture for More Instant Messaging Interoperability (MIMI)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">The More Instant Messaging Interoperability (MIMI) working group is defining a
suite of protocols that allow messaging providers to interoperate with one
another.  This document lays out an overall architecture enumerating the MIMI
protocols and how they work together to enable an overall messaging experience.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-barnes-mimi-arch/">https://datatracker.ietf.org/doc/draft-barnes-mimi-arch/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        More Instant Messaging Interoperability Working Group mailing list (<span><a href="mailto:mimi@ietf.org">mailto:mimi@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/mimi/">https://mailarchive.ietf.org/arch/browse/mimi/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/mimi/">https://www.ietf.org/mailman/listinfo/mimi/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/bifurcation/mimi-arch">https://github.com/bifurcation/mimi-arch</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 5 September 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-overall-scope" class="internal xref">Overall Scope</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-room-state" class="internal xref">Room State</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-end-to-end-security-state" class="internal xref">End-to-End Security State</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-participants-and-members" class="internal xref">Participants and Members</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-membership-changes" class="internal xref">Membership Changes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-policy" class="internal xref">Policy</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-protocol-interactions" class="internal xref">Protocol Interactions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-end-to-end-security" class="internal xref">End-to-End Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-events-and-transport" class="internal xref">Events and Transport</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-room-state-synchronization" class="internal xref">Room State Synchronization</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-messages" class="internal xref">Messages</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-actors-identifiers-and-auth" class="internal xref">Actors, Identifiers, and Authentication</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Today, there are many providers of messaging functionality.  A provider
typically provides the client software (e.g., a mobile app) and the servers that
facilitate communications among clients.  The core function of MIMI is enabling
users to have messaging interactions across message providers.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">This overall goal breaks down into several sub-goals:<a href="#section-1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-3.1">
          <p id="section-1-3.1.1">Message formats that enable the user-level features of a messaging system<a href="#section-1-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-3.2">
          <p id="section-1-3.2.1">Tracking of state across multiple providers<a href="#section-1-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-3.3">
          <p id="section-1-3.3.1">End-to-end security of user messages<a href="#section-1-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-3.4">
          <p id="section-1-3.4.1">Transport of protocol messages among providers<a href="#section-1-3.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-1-4">In this document, we describe the high-level functions of these protocols, and
how they work toegether to enable an overall messaging application.<a href="#section-1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">Terms are generally introduced in context, indicated by <em>emphasis</em>.<a href="#section-2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="overall-scope">
<section id="section-3">
      <h2 id="name-overall-scope">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-overall-scope" class="section-name selfRef">Overall Scope</a>
      </h2>
<p id="section-3-1"><a href="#overview" class="auto internal xref">Figure 1</a> shows the critical entities in the overall MIMI system and their
interactions.  Each human <em>user</em> is represented in the system by one or more
<em>clients</em>, where each client is a specific software or hardware system belonging
to a single user.  Each provider is represented by a <em>server</em> (logically a
single server, but possibly realized by multiple physical devices).<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">Messaging interactions are organized around <em>rooms</em>.  All messaging interactions
take place in the context of a room.  (Some non-messaging interactions may take
place outside of a room, such as operations to fetch information required to set
up a room.)  Rooms have a notion of
<em>user participation</em> as well as <em>client membership</em>, both tracked as lists.
Rooms additionally have policies about things like how the room may be joined
and what capabilities each member/participant has.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">The protocol interactions that drive a room unfold among the servers whose users
are participants in the room.  There is exactly one <em>hub</em> server for the room, which
is in primary control of the room.  All other servers are known as <em>followers</em>.
Follower servers interact directly with the hub server.  Interactions between
clients occur indirectly, via the servers for the clients' providers.<a href="#section-3-3" class="pilcrow">¶</a></p>
<span id="name-mimi-entities-and-interacti"></span><div id="overview">
<figure id="figure-1">
        <div id="section-3-4.1">
          <div class="alignLeft art-svg artwork" id="section-3-4.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="544" width="504" viewBox="0 0 504 544" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 112,256 L 112,320" fill="none" stroke="black"></path>
              <path d="M 136,88 L 136,136" fill="none" stroke="black"></path>
              <path d="M 136,264 L 136,312" fill="none" stroke="black"></path>
              <path d="M 136,440 L 136,488" fill="none" stroke="black"></path>
              <path d="M 152,64 L 152,96" fill="none" stroke="black"></path>
              <path d="M 152,128 L 152,160" fill="none" stroke="black"></path>
              <path d="M 152,240 L 152,272" fill="none" stroke="black"></path>
              <path d="M 152,304 L 152,336" fill="none" stroke="black"></path>
              <path d="M 152,416 L 152,448" fill="none" stroke="black"></path>
              <path d="M 152,480 L 152,512" fill="none" stroke="black"></path>
              <path d="M 240,64 L 240,96" fill="none" stroke="black"></path>
              <path d="M 240,128 L 240,160" fill="none" stroke="black"></path>
              <path d="M 240,240 L 240,272" fill="none" stroke="black"></path>
              <path d="M 240,304 L 240,336" fill="none" stroke="black"></path>
              <path d="M 240,416 L 240,448" fill="none" stroke="black"></path>
              <path d="M 240,480 L 240,512" fill="none" stroke="black"></path>
              <path d="M 264,80 L 264,144" fill="none" stroke="black"></path>
              <path d="M 264,256 L 264,320" fill="none" stroke="black"></path>
              <path d="M 264,432 L 264,496" fill="none" stroke="black"></path>
              <path d="M 288,96 L 288,128" fill="none" stroke="black"></path>
              <path d="M 288,272 L 288,304" fill="none" stroke="black"></path>
              <path d="M 288,448 L 288,480" fill="none" stroke="black"></path>
              <path d="M 320,64 L 320,88" fill="none" stroke="black"></path>
              <path d="M 320,136 L 320,160" fill="none" stroke="black"></path>
              <path d="M 320,240 L 320,264" fill="none" stroke="black"></path>
              <path d="M 320,312 L 320,336" fill="none" stroke="black"></path>
              <path d="M 320,416 L 320,440" fill="none" stroke="black"></path>
              <path d="M 320,488 L 320,512" fill="none" stroke="black"></path>
              <path d="M 344,64 L 344,88" fill="none" stroke="black"></path>
              <path d="M 344,136 L 344,264" fill="none" stroke="black"></path>
              <path d="M 344,312 L 344,440" fill="none" stroke="black"></path>
              <path d="M 344,488 L 344,512" fill="none" stroke="black"></path>
              <path d="M 376,128 L 376,272" fill="none" stroke="black"></path>
              <path d="M 376,304 L 376,448" fill="none" stroke="black"></path>
              <path d="M 392,96 L 392,128" fill="none" stroke="black"></path>
              <path d="M 392,272 L 392,304" fill="none" stroke="black"></path>
              <path d="M 392,448 L 392,480" fill="none" stroke="black"></path>
              <path d="M 496,64 L 496,512" fill="none" stroke="black"></path>
              <path d="M 152,48 L 304,48" fill="none" stroke="black"></path>
              <path d="M 360,48 L 480,48" fill="none" stroke="black"></path>
              <path d="M 24,64 L 56,64" fill="none" stroke="black"></path>
              <path d="M 152,64 L 240,64" fill="none" stroke="black"></path>
              <path d="M 72,80 L 152,80" fill="none" stroke="black"></path>
              <path d="M 240,80 L 264,80" fill="none" stroke="black"></path>
              <path d="M 24,96 L 56,96" fill="none" stroke="black"></path>
              <path d="M 152,96 L 240,96" fill="none" stroke="black"></path>
              <path d="M 288,96 L 392,96" fill="none" stroke="black"></path>
              <path d="M 264,112 L 288,112" fill="none" stroke="black"></path>
              <path d="M 24,128 L 40,128" fill="none" stroke="black"></path>
              <path d="M 152,128 L 240,128" fill="none" stroke="black"></path>
              <path d="M 288,128 L 392,128" fill="none" stroke="black"></path>
              <path d="M 56,144 L 152,144" fill="none" stroke="black"></path>
              <path d="M 240,144 L 264,144" fill="none" stroke="black"></path>
              <path d="M 24,160 L 40,160" fill="none" stroke="black"></path>
              <path d="M 152,160 L 240,160" fill="none" stroke="black"></path>
              <path d="M 152,176 L 304,176" fill="none" stroke="black"></path>
              <path d="M 152,224 L 304,224" fill="none" stroke="black"></path>
              <path d="M 152,240 L 240,240" fill="none" stroke="black"></path>
              <path d="M 112,256 L 152,256" fill="none" stroke="black"></path>
              <path d="M 240,256 L 264,256" fill="none" stroke="black"></path>
              <path d="M 24,272 L 72,272" fill="none" stroke="black"></path>
              <path d="M 152,272 L 240,272" fill="none" stroke="black"></path>
              <path d="M 288,272 L 392,272" fill="none" stroke="black"></path>
              <path d="M 88,288 L 112,288" fill="none" stroke="black"></path>
              <path d="M 264,288 L 288,288" fill="none" stroke="black"></path>
              <path d="M 24,304 L 72,304" fill="none" stroke="black"></path>
              <path d="M 152,304 L 240,304" fill="none" stroke="black"></path>
              <path d="M 288,304 L 392,304" fill="none" stroke="black"></path>
              <path d="M 112,320 L 152,320" fill="none" stroke="black"></path>
              <path d="M 240,320 L 264,320" fill="none" stroke="black"></path>
              <path d="M 152,336 L 240,336" fill="none" stroke="black"></path>
              <path d="M 152,352 L 304,352" fill="none" stroke="black"></path>
              <path d="M 152,400 L 304,400" fill="none" stroke="black"></path>
              <path d="M 24,416 L 56,416" fill="none" stroke="black"></path>
              <path d="M 152,416 L 240,416" fill="none" stroke="black"></path>
              <path d="M 72,432 L 152,432" fill="none" stroke="black"></path>
              <path d="M 240,432 L 264,432" fill="none" stroke="black"></path>
              <path d="M 24,448 L 56,448" fill="none" stroke="black"></path>
              <path d="M 152,448 L 240,448" fill="none" stroke="black"></path>
              <path d="M 288,448 L 392,448" fill="none" stroke="black"></path>
              <path d="M 264,464 L 288,464" fill="none" stroke="black"></path>
              <path d="M 24,480 L 64,480" fill="none" stroke="black"></path>
              <path d="M 152,480 L 240,480" fill="none" stroke="black"></path>
              <path d="M 288,480 L 392,480" fill="none" stroke="black"></path>
              <path d="M 80,496 L 152,496" fill="none" stroke="black"></path>
              <path d="M 240,496 L 264,496" fill="none" stroke="black"></path>
              <path d="M 24,512 L 64,512" fill="none" stroke="black"></path>
              <path d="M 152,512 L 240,512" fill="none" stroke="black"></path>
              <path d="M 152,528 L 304,528" fill="none" stroke="black"></path>
              <path d="M 360,528 L 480,528" fill="none" stroke="black"></path>
              <path d="M 152,48 C 143.16936,48 136,55.16936 136,64" fill="none" stroke="black"></path>
              <path d="M 304,48 C 312.83064,48 320,55.16936 320,64" fill="none" stroke="black"></path>
              <path d="M 360,48 C 351.16936,48 344,55.16936 344,64" fill="none" stroke="black"></path>
              <path d="M 480,48 C 488.83064,48 496,55.16936 496,64" fill="none" stroke="black"></path>
              <path d="M 24,64 C 15.16936,64 8,71.16936 8,80" fill="none" stroke="black"></path>
              <path d="M 56,64 C 64.83064,64 72,71.16936 72,80" fill="none" stroke="black"></path>
              <path d="M 24,96 C 15.16936,96 8,88.83064 8,80" fill="none" stroke="black"></path>
              <path d="M 56,96 C 64.83064,96 72,88.83064 72,80" fill="none" stroke="black"></path>
              <path d="M 24,128 C 15.16936,128 8,135.16936 8,144" fill="none" stroke="black"></path>
              <path d="M 40,128 C 48.83064,128 56,135.16936 56,144" fill="none" stroke="black"></path>
              <path d="M 24,160 C 15.16936,160 8,152.83064 8,144" fill="none" stroke="black"></path>
              <path d="M 40,160 C 48.83064,160 56,152.83064 56,144" fill="none" stroke="black"></path>
              <path d="M 152,176 C 143.16936,176 136,168.83064 136,160" fill="none" stroke="black"></path>
              <path d="M 304,176 C 312.83064,176 320,168.83064 320,160" fill="none" stroke="black"></path>
              <path d="M 152,224 C 143.16936,224 136,231.16936 136,240" fill="none" stroke="black"></path>
              <path d="M 304,224 C 312.83064,224 320,231.16936 320,240" fill="none" stroke="black"></path>
              <path d="M 24,272 C 15.16936,272 8,279.16936 8,288" fill="none" stroke="black"></path>
              <path d="M 72,272 C 80.83064,272 88,279.16936 88,288" fill="none" stroke="black"></path>
              <path d="M 24,304 C 15.16936,304 8,296.83064 8,288" fill="none" stroke="black"></path>
              <path d="M 72,304 C 80.83064,304 88,296.83064 88,288" fill="none" stroke="black"></path>
              <path d="M 152,352 C 143.16936,352 136,344.83064 136,336" fill="none" stroke="black"></path>
              <path d="M 304,352 C 312.83064,352 320,344.83064 320,336" fill="none" stroke="black"></path>
              <path d="M 152,400 C 143.16936,400 136,407.16936 136,416" fill="none" stroke="black"></path>
              <path d="M 304,400 C 312.83064,400 320,407.16936 320,416" fill="none" stroke="black"></path>
              <path d="M 24,416 C 15.16936,416 8,423.16936 8,432" fill="none" stroke="black"></path>
              <path d="M 56,416 C 64.83064,416 72,423.16936 72,432" fill="none" stroke="black"></path>
              <path d="M 24,448 C 15.16936,448 8,440.83064 8,432" fill="none" stroke="black"></path>
              <path d="M 56,448 C 64.83064,448 72,440.83064 72,432" fill="none" stroke="black"></path>
              <path d="M 24,480 C 15.16936,480 8,487.16936 8,496" fill="none" stroke="black"></path>
              <path d="M 64,480 C 72.83064,480 80,487.16936 80,496" fill="none" stroke="black"></path>
              <path d="M 24,512 C 15.16936,512 8,504.83064 8,496" fill="none" stroke="black"></path>
              <path d="M 64,512 C 72.83064,512 80,504.83064 80,496" fill="none" stroke="black"></path>
              <path d="M 152,528 C 143.16936,528 136,520.83064 136,512" fill="none" stroke="black"></path>
              <path d="M 304,528 C 312.83064,528 320,520.83064 320,512" fill="none" stroke="black"></path>
              <path d="M 360,528 C 351.16936,528 344,520.83064 344,512" fill="none" stroke="black"></path>
              <path d="M 480,528 C 488.83064,528 496,520.83064 496,512" fill="none" stroke="black"></path>
              <g class="text">
                <text x="40" y="36">Users</text>
                <text x="188" y="36">Provider</text>
                <text x="232" y="36">X</text>
                <text x="380" y="36">Room</text>
                <text x="416" y="36">123</text>
                <text x="40" y="84">Alice</text>
                <text x="188" y="84">Client</text>
                <text x="224" y="84">A</text>
                <text x="332" y="116">Server</text>
                <text x="368" y="116">1</text>
                <text x="444" y="116">(Follower)</text>
                <text x="32" y="148">Bob</text>
                <text x="188" y="148">Client</text>
                <text x="224" y="148">B</text>
                <text x="188" y="212">Provider</text>
                <text x="232" y="212">Y</text>
                <text x="188" y="260">Client</text>
                <text x="224" y="260">C</text>
                <text x="48" y="292">Charlie</text>
                <text x="332" y="292">Server</text>
                <text x="368" y="292">2</text>
                <text x="424" y="292">(Hub)</text>
                <text x="188" y="324">Client</text>
                <text x="224" y="324">D</text>
                <text x="188" y="388">Provider</text>
                <text x="232" y="388">Z</text>
                <text x="40" y="436">Diana</text>
                <text x="188" y="436">Client</text>
                <text x="224" y="436">E</text>
                <text x="332" y="468">Server</text>
                <text x="368" y="468">3</text>
                <text x="444" y="468">(Follower)</text>
                <text x="44" y="500">Evelyn</text>
                <text x="188" y="500">Client</text>
                <text x="224" y="500">F</text>
              </g>
            </svg><a href="#section-3-4.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-mimi-entities-and-interacti" class="selfRef">MIMI Entities and Interactions</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="room-state">
<section id="section-4">
      <h2 id="name-room-state">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-room-state" class="section-name selfRef">Room State</a>
      </h2>
<p id="section-4-1">A room represnts a messaging interaction among a specific set of clients, with a
single <em>state</em>.  A major goal of the MIMI protocols is to syncrhonize the state
of a room across all of the servers and clients participating in the room.
Changes to the room's state can be proposed by either clients or servers, though
as dicussed in <a href="#policy" class="auto internal xref">Section 4.4</a>, one important aspect of the room's state is an
authorization policy that determines which actors are allowed to make which
changes.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">The creation of a room is a local operation on the hub server, and thus outside
the scope of MIMI.  The hub server establishes the initial state of the room.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">The state of the room includes a few types of information, most importantly:<a href="#section-4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-4.1">
          <p id="section-4-4.1.1">The end-to-end security state of the room<a href="#section-4-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-4.2">
          <p id="section-4-4.2.1">The user-level participation state of the room<a href="#section-4-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-4.3">
          <p id="section-4-4.3.1">The authorization policy for the room<a href="#section-4-4.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<span id="name-elements-of-the-room-state"></span><div id="fig-room-state">
<figure id="figure-2">
        <div id="section-4-5.1">
          <div class="alignLeft art-svg artwork" id="section-4-5.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="384" width="552" viewBox="0 0 552 384" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,32 L 8,368" fill="none" stroke="black"></path>
              <path d="M 160,32 L 160,120" fill="none" stroke="black"></path>
              <path d="M 160,136 L 160,184" fill="none" stroke="black"></path>
              <path d="M 160,200 L 160,312" fill="none" stroke="black"></path>
              <path d="M 160,328 L 160,368" fill="none" stroke="black"></path>
              <path d="M 192,32 L 192,120" fill="none" stroke="black"></path>
              <path d="M 192,136 L 192,184" fill="none" stroke="black"></path>
              <path d="M 192,200 L 192,312" fill="none" stroke="black"></path>
              <path d="M 192,328 L 192,368" fill="none" stroke="black"></path>
              <path d="M 384,32 L 384,120" fill="none" stroke="black"></path>
              <path d="M 384,136 L 384,184" fill="none" stroke="black"></path>
              <path d="M 384,200 L 384,368" fill="none" stroke="black"></path>
              <path d="M 400,192 L 400,256" fill="none" stroke="black"></path>
              <path d="M 416,32 L 416,120" fill="none" stroke="black"></path>
              <path d="M 416,136 L 416,184" fill="none" stroke="black"></path>
              <path d="M 416,200 L 416,248" fill="none" stroke="black"></path>
              <path d="M 416,264 L 416,368" fill="none" stroke="black"></path>
              <path d="M 544,32 L 544,368" fill="none" stroke="black"></path>
              <path d="M 8,32 L 160,32" fill="none" stroke="black"></path>
              <path d="M 192,32 L 384,32" fill="none" stroke="black"></path>
              <path d="M 416,32 L 544,32" fill="none" stroke="black"></path>
              <path d="M 40,112 L 128,112" fill="none" stroke="black"></path>
              <path d="M 224,112 L 352,112" fill="none" stroke="black"></path>
              <path d="M 448,112 L 512,112" fill="none" stroke="black"></path>
              <path d="M 144,128 L 208,128" fill="none" stroke="black"></path>
              <path d="M 368,128 L 432,128" fill="none" stroke="black"></path>
              <path d="M 40,144 L 128,144" fill="none" stroke="black"></path>
              <path d="M 224,144 L 352,144" fill="none" stroke="black"></path>
              <path d="M 448,144 L 512,144" fill="none" stroke="black"></path>
              <path d="M 40,176 L 128,176" fill="none" stroke="black"></path>
              <path d="M 224,176 L 352,176" fill="none" stroke="black"></path>
              <path d="M 448,176 L 512,176" fill="none" stroke="black"></path>
              <path d="M 144,192 L 208,192" fill="none" stroke="black"></path>
              <path d="M 368,192 L 432,192" fill="none" stroke="black"></path>
              <path d="M 40,208 L 128,208" fill="none" stroke="black"></path>
              <path d="M 224,208 L 352,208" fill="none" stroke="black"></path>
              <path d="M 448,208 L 512,208" fill="none" stroke="black"></path>
              <path d="M 448,240 L 512,240" fill="none" stroke="black"></path>
              <path d="M 400,256 L 432,256" fill="none" stroke="black"></path>
              <path d="M 448,272 L 512,272" fill="none" stroke="black"></path>
              <path d="M 40,304 L 128,304" fill="none" stroke="black"></path>
              <path d="M 224,304 L 352,304" fill="none" stroke="black"></path>
              <path d="M 144,320 L 208,320" fill="none" stroke="black"></path>
              <path d="M 40,336 L 128,336" fill="none" stroke="black"></path>
              <path d="M 224,336 L 352,336" fill="none" stroke="black"></path>
              <path d="M 8,368 L 160,368" fill="none" stroke="black"></path>
              <path d="M 192,368 L 384,368" fill="none" stroke="black"></path>
              <path d="M 416,368 L 544,368" fill="none" stroke="black"></path>
              <path d="M 40,112 C 31.16936,112 24,119.16936 24,128" fill="none" stroke="black"></path>
              <path d="M 128,112 C 136.83064,112 144,119.16936 144,128" fill="none" stroke="black"></path>
              <path d="M 224,112 C 215.16936,112 208,119.16936 208,128" fill="none" stroke="black"></path>
              <path d="M 352,112 C 360.83064,112 368,119.16936 368,128" fill="none" stroke="black"></path>
              <path d="M 448,112 C 439.16936,112 432,119.16936 432,128" fill="none" stroke="black"></path>
              <path d="M 512,112 C 520.83064,112 528,119.16936 528,128" fill="none" stroke="black"></path>
              <path d="M 40,144 C 31.16936,144 24,136.83064 24,128" fill="none" stroke="black"></path>
              <path d="M 128,144 C 136.83064,144 144,136.83064 144,128" fill="none" stroke="black"></path>
              <path d="M 224,144 C 215.16936,144 208,136.83064 208,128" fill="none" stroke="black"></path>
              <path d="M 352,144 C 360.83064,144 368,136.83064 368,128" fill="none" stroke="black"></path>
              <path d="M 448,144 C 439.16936,144 432,136.83064 432,128" fill="none" stroke="black"></path>
              <path d="M 512,144 C 520.83064,144 528,136.83064 528,128" fill="none" stroke="black"></path>
              <path d="M 40,176 C 31.16936,176 24,183.16936 24,192" fill="none" stroke="black"></path>
              <path d="M 128,176 C 136.83064,176 144,183.16936 144,192" fill="none" stroke="black"></path>
              <path d="M 224,176 C 215.16936,176 208,183.16936 208,192" fill="none" stroke="black"></path>
              <path d="M 352,176 C 360.83064,176 368,183.16936 368,192" fill="none" stroke="black"></path>
              <path d="M 448,176 C 439.16936,176 432,183.16936 432,192" fill="none" stroke="black"></path>
              <path d="M 512,176 C 520.83064,176 528,183.16936 528,192" fill="none" stroke="black"></path>
              <path d="M 40,208 C 31.16936,208 24,200.83064 24,192" fill="none" stroke="black"></path>
              <path d="M 128,208 C 136.83064,208 144,200.83064 144,192" fill="none" stroke="black"></path>
              <path d="M 224,208 C 215.16936,208 208,200.83064 208,192" fill="none" stroke="black"></path>
              <path d="M 352,208 C 360.83064,208 368,200.83064 368,192" fill="none" stroke="black"></path>
              <path d="M 448,208 C 439.16936,208 432,200.83064 432,192" fill="none" stroke="black"></path>
              <path d="M 512,208 C 520.83064,208 528,200.83064 528,192" fill="none" stroke="black"></path>
              <path d="M 448,240 C 439.16936,240 432,247.16936 432,256" fill="none" stroke="black"></path>
              <path d="M 512,240 C 520.83064,240 528,247.16936 528,256" fill="none" stroke="black"></path>
              <path d="M 448,272 C 439.16936,272 432,264.83064 432,256" fill="none" stroke="black"></path>
              <path d="M 512,272 C 520.83064,272 528,264.83064 528,256" fill="none" stroke="black"></path>
              <path d="M 40,304 C 31.16936,304 24,311.16936 24,320" fill="none" stroke="black"></path>
              <path d="M 128,304 C 136.83064,304 144,311.16936 144,320" fill="none" stroke="black"></path>
              <path d="M 224,304 C 215.16936,304 208,311.16936 208,320" fill="none" stroke="black"></path>
              <path d="M 352,304 C 360.83064,304 368,311.16936 368,320" fill="none" stroke="black"></path>
              <path d="M 40,336 C 31.16936,336 24,328.83064 24,320" fill="none" stroke="black"></path>
              <path d="M 128,336 C 136.83064,336 144,328.83064 144,320" fill="none" stroke="black"></path>
              <path d="M 224,336 C 215.16936,336 208,328.83064 208,320" fill="none" stroke="black"></path>
              <path d="M 352,336 C 360.83064,336 368,328.83064 368,320" fill="none" stroke="black"></path>
              <g class="text">
                <text x="80" y="68">Authorization</text>
                <text x="272" y="68">Participant</text>
                <text x="340" y="68">List</text>
                <text x="440" y="68">E2E</text>
                <text x="492" y="68">Security</text>
                <text x="84" y="84">Policy</text>
                <text x="480" y="84">State</text>
                <text x="52" y="132">User</text>
                <text x="80" y="132">1</text>
                <text x="112" y="132">Capas</text>
                <text x="244" y="132">User</text>
                <text x="272" y="132">1</text>
                <text x="316" y="132">(active)</text>
                <text x="468" y="132">Client</text>
                <text x="508" y="132">1a</text>
                <text x="52" y="196">User</text>
                <text x="80" y="196">2</text>
                <text x="112" y="196">Capas</text>
                <text x="244" y="196">User</text>
                <text x="272" y="196">2</text>
                <text x="316" y="196">(active)</text>
                <text x="468" y="196">Client</text>
                <text x="508" y="196">2a</text>
                <text x="468" y="260">Client</text>
                <text x="508" y="260">2b</text>
                <text x="52" y="324">User</text>
                <text x="80" y="324">2</text>
                <text x="112" y="324">Capas</text>
                <text x="236" y="324">User</text>
                <text x="264" y="324">2</text>
                <text x="316" y="324">(inactive)</text>
              </g>
            </svg><a href="#section-4-5.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-elements-of-the-room-state" class="selfRef">Elements of the Room State</a>
        </figcaption></figure>
</div>
<div id="end-to-end-security-state">
<section id="section-4.1">
        <h3 id="name-end-to-end-security-state">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-end-to-end-security-state" class="section-name selfRef">End-to-End Security State</a>
        </h3>
<p id="section-4.1-1">Messages sent within a room are protected by an end-to-end security protocol to
ensure that the servers handling messages cannot inspect or tamper with
messages.  This means that the required cryptographic keys need to be
provisioned to any client from which a user can interact with the room.  The
state of this end-to-end security protocol thus represents the precise set of
clients that can send and receive messages in the room, the most precise notion
of membership for a room.  A client that has the required keys for end-to-end
security is said to be a member of the end-to-end security state of the room.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">The end-to-end security state of a room has public and private aspects.  Servers
may store the public aspects of the end-to-end security state, such as
identities and credentials presented by the clients in the room.  The private
aspects of the group, such as the symmetric encryption keys, are known only to
the clients.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="participants-and-members">
<section id="section-4.2">
        <h3 id="name-participants-and-members">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-participants-and-members" class="section-name selfRef">Participants and Members</a>
        </h3>
<p id="section-4.2-1">The <em>participant list</em> for a room is the set of users who are allowed to interact
with the room in some way.  The specific list of ways in which a user may
participate is defined by authorization policy, as discussed in <a href="#policy" class="auto internal xref">Section 4.4</a>.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">Note the parallel terminology with regard to inclusion of clients or users in
the room:<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-3.1">
            <p id="section-4.2-3.1.1">A <em>client</em> is a <em>member</em> of the <em>end-to-end security state</em> of the room<a href="#section-4.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-3.2">
            <p id="section-4.2-3.2.1">A <em>user</em> is a <em>participant</em> in the room<a href="#section-4.2-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.2-4">The user-level <em>participant list</em> and the client-level <em>membership</em> of the room
are distinct entities managed by separate protocols, but they must be consistent
with each other.  A client may be a member of the E2EE state of a room only if
its user is a participant in the room.  However, a user may be a participant in
a room without any client belonging to the user being part of the end-to-end
security state of the room.  (Such a user will not be able to read or send
messages, but may be able to take other actions.  It is up to client
implementations how this state is represented.)<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<p id="section-4.2-5">A user with at least one client joined to the end-to-end security state of the
room is known as an <em>active user</em>, since such a user can fully participate in
the room.<a href="#section-4.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="membership-changes">
<section id="section-4.3">
        <h3 id="name-membership-changes">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-membership-changes" class="section-name selfRef">Membership Changes</a>
        </h3>
<p id="section-4.3-1">The participant list and client membership of a group can change over time, via <em>add</em> and <em>remove</em>
operations at both the user level and the client level.  These operations are
independent at the protocol level: For example, a user may be added to a room
before any of its clients are available to join, or a user may begin using a new
device (adding the device without changing the user-level participation).<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">As discussed above, user-level participation and client-level membership must be kept in sync.
When a user is added, some set of their clients should be added as well; when a
user leaves or is evicted, any clients joined to the room should be removed.
The cryptographic constraints of end-to-end security protocols mean that servers
cannot perform this synchronization; it is up to clients to keep these two types
of state in sync.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="policy">
<section id="section-4.4">
        <h3 id="name-policy">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-policy" class="section-name selfRef">Policy</a>
        </h3>
<p id="section-4.4-1">Each room has an associated <em>policy</em> that governs which protocol actions are
authorized for the room while the policy is in effect.  The policy defines
several aspects of the room's behavior, for example:<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-2.1">
            <p id="section-4.4-2.1.1">Admission policy: Do new members need to be explicitly added by a current
member of the room, or can some set of users join unilaterally?<a href="#section-4.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.4-2.2">
            <p id="section-4.4-2.2.1">Capabilities per user: Is a given user allowed to ...<a href="#section-4.4-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-2.2.2.1">
                <p id="section-4.4-2.2.2.1.1">Send messages in the room?<a href="#section-4.4-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.4-2.2.2.2">
                <p id="section-4.4-2.2.2.2.1">Add or remove other users?<a href="#section-4.4-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.4-2.2.2.3">
                <p id="section-4.4-2.2.2.3.1">Grant or deny capabilities to other users?<a href="#section-4.4-2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-4.4-2.3">
            <p id="section-4.4-2.3.1">Capabilities per server: Is a given server participating in the room allowed
to...<a href="#section-4.4-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-2.3.2.1">
                <p id="section-4.4-2.3.2.1.1">Add or remove users?<a href="#section-4.4-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.4-2.3.2.2">
                <p id="section-4.4-2.3.2.2.1">Grant or deny capabilities to users?<a href="#section-4.4-2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-4.4-3">The hub server for a room defines the <em>policy envelope</em> for the room, the set of
of acceptable policies for the room.  The hub also sets the initial policy for
the room when it is created.  Pursuant to that initial policy, the clients and
servers participating in the room may then make further changes to the policy.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<p id="section-4.4-4">At any given time, all of the clients and servers have the same view of the
room's policy.  A client or server that receives an event that is not compliant
with the room's policy may thus safely discard it, since all of the other
participating clients/servers should also reject the event.<a href="#section-4.4-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="protocol-interactions">
<section id="section-5">
      <h2 id="name-protocol-interactions">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-protocol-interactions" class="section-name selfRef">Protocol Interactions</a>
      </h2>
<p id="section-5-1">As shown in <a href="#fig-protocols" class="auto internal xref">Figure 3</a>, MIMI protocols define server-to-server interactions and
client-to-client interactions.  Each client interacts with the overall system by
means of its provider's server (whether hub or follower).  Client-to-client
interactions are done by means of these servers.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">The messages sent within a room are forwarded among participating clients by
servers.  However, messages are protected by an end-to-end security protocol so
that their content is only accessible to the clients participating in the room.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">In addition to forwarding messages, servers participate in control protocols
that coordinate the state of the room across the participating providers.  Both
message forwarding and control protocols leverage a common framework for sharing
<em>events</em> among servers.  Events are protected with the same end-to-end security
protocol as clients' messages, so that the actors updating a room are
authenticated and the clients participating in a room can confirm that they
agree on the state of the room.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">Note that some parts of the overall system are explicitly out of scope for MIMI.
Namely, client-server interactions internal to a provider (indicated by
"(Provider)" in <a href="#fig-protocols" class="auto internal xref">Figure 3</a>) can be arranged however the provider likes.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">The MIMI protocol implemented by servers thus incorporates a few sub-protocols:<a href="#section-5-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-6.1">
          <p id="section-5-6.1.1">A transport protocol for sending room events among servers<a href="#section-5-6.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-6.2">
          <p id="section-5-6.2.1">A state synchronization protocol for coordinating updates to the room state<a href="#section-5-6.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-6.3">
          <p id="section-5-6.3.1">A message forwarding protocol<a href="#section-5-6.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-5-7">A common end-to-end security layer provide common security services to all of
these functions.<a href="#section-5-7" class="pilcrow">¶</a></p>
<span id="name-mimi-protocols"></span><div id="fig-protocols">
<figure id="figure-3">
        <div id="section-5-8.1">
          <div class="alignLeft art-svg artwork" id="section-5-8.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="320" width="520" viewBox="0 0 520 320" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 24,112 L 24,304" fill="none" stroke="black"></path>
              <path d="M 144,112 L 144,144" fill="none" stroke="black"></path>
              <path d="M 144,176 L 144,304" fill="none" stroke="black"></path>
              <path d="M 256,112 L 256,128" fill="none" stroke="black"></path>
              <path d="M 256,176 L 256,192" fill="none" stroke="black"></path>
              <path d="M 256,232 L 256,304" fill="none" stroke="black"></path>
              <path d="M 368,112 L 368,144" fill="none" stroke="black"></path>
              <path d="M 368,176 L 368,304" fill="none" stroke="black"></path>
              <path d="M 488,112 L 488,304" fill="none" stroke="black"></path>
              <path d="M 24,64 L 72,64" fill="none" stroke="black"></path>
              <path d="M 104,64 L 160,64" fill="none" stroke="black"></path>
              <path d="M 208,64 L 240,64" fill="none" stroke="black"></path>
              <path d="M 272,64 L 312,64" fill="none" stroke="black"></path>
              <path d="M 360,64 L 408,64" fill="none" stroke="black"></path>
              <path d="M 440,64 L 496,64" fill="none" stroke="black"></path>
              <path d="M 32,158 L 480,158" fill="none" stroke="black"></path>
              <path d="M 32,162 L 480,162" fill="none" stroke="black"></path>
              <path d="M 32,224 Q 34,220.8 36,224 Q 38,227.2 40,224 Q 42,220.8 44,224 Q 46,227.2 48,224 Q 50,220.8 52,224 Q 54,227.2 56,224 Q 58,220.8 60,224 Q 62,227.2 64,224 Q 66,220.8 68,224 Q 70,227.2 72,224 Q 74,220.8 76,224 Q 78,227.2 80,224 Q 82,220.8 84,224 Q 86,227.2 88,224 Q 90,220.8 92,224 Q 94,227.2 96,224 Q 98,220.8 100,224 Q 102,227.2 104,224 Q 106,220.8 108,224 Q 110,227.2 112,224 Q 114,220.8 116,224 Q 118,227.2 120,224 Q 122,220.8 124,224 Q 126,227.2 128,224 Q 130,220.8 132,224 Q 134,227.2 136,224" fill="none" stroke="black"></path>
              <path d="M 152,224 L 360,224" fill="none" stroke="black"></path>
              <path d="M 376,224 Q 378,220.8 380,224 Q 382,227.2 384,224 Q 386,220.8 388,224 Q 390,227.2 392,224 Q 394,220.8 396,224 Q 398,227.2 400,224 Q 402,220.8 404,224 Q 406,227.2 408,224 Q 410,220.8 412,224 Q 414,227.2 416,224 Q 418,220.8 420,224 Q 422,227.2 424,224 Q 426,220.8 428,224 Q 430,227.2 432,224 Q 434,220.8 436,224 Q 438,227.2 440,224 Q 442,220.8 444,224 Q 446,227.2 448,224 Q 450,220.8 452,224 Q 454,227.2 456,224 Q 458,220.8 460,224 Q 462,227.2 464,224 Q 466,220.8 468,224 Q 470,227.2 472,224 Q 474,220.8 476,224 Q 478,227.2 480,224" fill="none" stroke="black"></path>
              <path d="M 152,288 L 248,288" fill="none" stroke="black"></path>
              <path d="M 264,288 L 360,288" fill="none" stroke="black"></path>
              <path d="M 24,64 C 15.16936,64 8,71.16936 8,80" fill="none" stroke="black"></path>
              <path d="M 72,64 C 80.83064,64 88,56.83064 88,48" fill="none" stroke="black"></path>
              <path d="M 104,64 C 95.16936,64 88,56.83064 88,48" fill="none" stroke="black"></path>
              <path d="M 160,64 C 168.83064,64 176,71.16936 176,80" fill="none" stroke="black"></path>
              <path d="M 208,64 C 199.16936,64 192,71.16936 192,80" fill="none" stroke="black"></path>
              <path d="M 240,64 C 248.83064,64 256,56.83064 256,48" fill="none" stroke="black"></path>
              <path d="M 272,64 C 263.16936,64 256,56.83064 256,48" fill="none" stroke="black"></path>
              <path d="M 312,64 C 320.83064,64 328,71.16936 328,80" fill="none" stroke="black"></path>
              <path d="M 360,64 C 351.16936,64 344,71.16936 344,80" fill="none" stroke="black"></path>
              <path d="M 408,64 C 416.83064,64 424,56.83064 424,48" fill="none" stroke="black"></path>
              <path d="M 440,64 C 431.16936,64 424,56.83064 424,48" fill="none" stroke="black"></path>
              <path d="M 496,64 C 504.83064,64 512,71.16936 512,80" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="488,224 476,218.4 476,229.6" fill="black" transform="rotate(0,480,224)"></polygon>
              <polygon class="arrowhead" points="488,160 476,154.4 476,165.6" fill="black" transform="rotate(0,480,160)"></polygon>
              <polygon class="arrowhead" points="384,224 372,218.4 372,229.6" fill="black" transform="rotate(180,376,224)"></polygon>
              <polygon class="arrowhead" points="368,288 356,282.4 356,293.6" fill="black" transform="rotate(0,360,288)"></polygon>
              <polygon class="arrowhead" points="368,224 356,218.4 356,229.6" fill="black" transform="rotate(0,360,224)"></polygon>
              <polygon class="arrowhead" points="272,288 260,282.4 260,293.6" fill="black" transform="rotate(180,264,288)"></polygon>
              <polygon class="arrowhead" points="256,288 244,282.4 244,293.6" fill="black" transform="rotate(0,248,288)"></polygon>
              <polygon class="arrowhead" points="160,288 148,282.4 148,293.6" fill="black" transform="rotate(180,152,288)"></polygon>
              <polygon class="arrowhead" points="160,224 148,218.4 148,229.6" fill="black" transform="rotate(180,152,224)"></polygon>
              <polygon class="arrowhead" points="144,224 132,218.4 132,229.6" fill="black" transform="rotate(0,136,224)"></polygon>
              <polygon class="arrowhead" points="40,224 28,218.4 28,229.6" fill="black" transform="rotate(180,32,224)"></polygon>
              <polygon class="arrowhead" points="40,160 28,154.4 28,165.6" fill="black" transform="rotate(180,32,160)"></polygon>
              <g class="text">
                <text x="92" y="36">Provider</text>
                <text x="260" y="36">Provider</text>
                <text x="428" y="36">Provider</text>
                <text x="28" y="100">Client</text>
                <text x="148" y="100">Follower</text>
                <text x="256" y="100">Hub</text>
                <text x="372" y="100">Follower</text>
                <text x="492" y="100">Client</text>
                <text x="256" y="148">Messaging</text>
                <text x="84" y="212">(Provider)</text>
                <text x="256" y="212">Control</text>
                <text x="428" y="212">(Provider)</text>
                <text x="200" y="276">Transport</text>
                <text x="312" y="276">Transport</text>
              </g>
            </svg><a href="#section-5-8.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-mimi-protocols" class="selfRef">MIMI Protocols</a>
        </figcaption></figure>
</div>
<div id="end-to-end-security">
<section id="section-5.1">
        <h3 id="name-end-to-end-security">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-end-to-end-security" class="section-name selfRef">End-to-End Security</a>
        </h3>
<p id="section-5.1-1">As noted above, all of the clients participating in a room are part of the same
end-to-end security context.  This allows them to protect their messages so that
they are secure from inspection or tampering as they transit MIMI servers.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">In addition to the message protection noted above, the end-to-end security layer
of the protocol provides a few additional functions to the remainder of the
protocol:<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-3.1">
            <p id="section-5.1-3.1.1">Authentication of the actors making changes to a room<a href="#section-5.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-3.2">
            <p id="section-5.1-3.2.1">Confirmation that the clients in a room agree on the state of the room<a href="#section-5.1-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.1-4">The authentication function allows MIMI servers to verify the identity of a
client making a change to the room, as an input to a policy evaluation to check
whether the change is authorized.  MIMI servers can make changes to a room,
within the bounds of the room's authorization policy.  Thus, MIMI servers also
need to be represented in the end-to-end security state of the room, but as
actors who can only authenticate, and are not given access to confidential
end-to-end security state.  In MLS terms, they are added as external senders,
not as members of the group.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1-5">The MIMI protocol includes end-to-end security components to keep the end-to-end
security state of the room aligned with the room's participant list, and to
ensure that all clients participating in the room have the proper configuration
(e.g., trusting the appropriate set of servers).<a href="#section-5.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="events-and-transport">
<section id="section-5.2">
        <h3 id="name-events-and-transport">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-events-and-transport" class="section-name selfRef">Events and Transport</a>
        </h3>
<p id="section-5.2-1">A room's activities are realized by servers exchanging <em>events</em>.  Events come in
two types:<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-2.1">
            <p id="section-5.2-2.1.1"><strong>State events</strong>, which make changes to the room state<a href="#section-5.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-2.2">
            <p id="section-5.2-2.2.1"><strong>Message events</strong>, which describe actual messaging activity in the room<a href="#section-5.2-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.2-3">Each event originates at one of the servers participating in the room (possibly
as a result of some interaction with a client).  The originating server sends
the event to the hub server for the room, who distributes it to the other follower
servers.<a href="#section-5.2-3" class="pilcrow">¶</a></p>
<p id="section-5.2-4">Each event is authenticated by its originating server so that all other
participating servers can verify its origin, even those to whom the event has
been distributed by the hub.  If an event was ultimately created by a client, it
is also authenticated by the client that created it.<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<p id="section-5.2-5">The overall MIMI protocol defines this event framework, including its
authentication scheme, as well as the mechanics of how events are delivered from
one server to another.<a href="#section-5.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="room-state-synchronization">
<section id="section-5.3">
        <h3 id="name-room-state-synchronization">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-room-state-synchronization" class="section-name selfRef">Room State Synchronization</a>
        </h3>
<p id="section-5.3-1">The servers involved in a room use an application state synchronization protocol
to coordinate changes to a room's state, particularly those listed in
<a href="#room-state" class="auto internal xref">Section 4</a>.  A few types of room state are synchronized, in what can be
viewed as independent control sub-protocols:<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">A <strong>policy control protocol</strong> distributes information about the policy
envelope of a room, and allows participants in a room to propose changes to the
policy within that envelope.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">A <strong>participation control protocol</strong> manages the user-level membership of the
room, including the various ways that members might join or leave a room (or be
added/removed by other users).<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<p id="section-5.3-4">As discussed above, the <strong>end-to-end security control protocol</strong> manages the
end-to-end security state of the room.  This protocol also allows servers to
distribute cryptographic information that clients have pre-registered, which
allows clients to be asynchronously added to rooms.<a href="#section-5.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="messages">
<section id="section-5.4">
        <h3 id="name-messages">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-messages" class="section-name selfRef">Messages</a>
        </h3>
<p id="section-5.4-1">Mesage events are end-to-end secure objects that carry application messages in
the standard MIMI content format.  The end-to-end encapsuation ensures that the
message content is only accessible to the clients participating in the room, not
the servers that help to distribute it.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">The MIMI message format <span>[<a href="#I-D.ietf-mimi-content" class="cite xref">I-D.ietf-mimi-content</a>]</span> defines how clients achieve
the various features of a messaging application, for example:<a href="#section-5.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4-3.1">
            <p id="section-5.4-3.1.1">Text messaging<a href="#section-5.4-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.4-3.2">
            <p id="section-5.4-3.2.1">File attachements<a href="#section-5.4-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.4-3.3">
            <p id="section-5.4-3.3.1">Replies<a href="#section-5.4-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.4-3.4">
            <p id="section-5.4-3.4.1">Reactions<a href="#section-5.4-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.4-3.5">
            <p id="section-5.4-3.5.1">Initiation of real-time sessions<a href="#section-5.4-3.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.4-4">Messages transit MIMI servers by means of a <strong>message forwarding protocol</strong>,
which carries an opaque, encrypted message payload together with enough metadata
to facilitate delivery to the clients participating in a room.<a href="#section-5.4-4" class="pilcrow">¶</a></p>
<span id="name-the-hub-fans-out-messages-t"></span><div id="fig-fanout">
<figure id="figure-4">
          <div id="section-5.4-5.1">
            <div class="alignLeft art-svg artwork" id="section-5.4-5.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="448" width="504" viewBox="0 0 504 448" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 136,64 L 136,88" fill="none" stroke="black"></path>
                <path d="M 136,104 L 136,128" fill="none" stroke="black"></path>
                <path d="M 136,208 L 136,232" fill="none" stroke="black"></path>
                <path d="M 136,248 L 136,272" fill="none" stroke="black"></path>
                <path d="M 136,352 L 136,376" fill="none" stroke="black"></path>
                <path d="M 136,392 L 136,416" fill="none" stroke="black"></path>
                <path d="M 152,80 L 152,112" fill="none" stroke="black"></path>
                <path d="M 152,224 L 152,256" fill="none" stroke="black"></path>
                <path d="M 152,368 L 152,400" fill="none" stroke="black"></path>
                <path d="M 240,80 L 240,112" fill="none" stroke="black"></path>
                <path d="M 240,224 L 240,256" fill="none" stroke="black"></path>
                <path d="M 240,368 L 240,400" fill="none" stroke="black"></path>
                <path d="M 288,80 L 288,112" fill="none" stroke="black"></path>
                <path d="M 288,224 L 288,256" fill="none" stroke="black"></path>
                <path d="M 288,368 L 288,400" fill="none" stroke="black"></path>
                <path d="M 344,120 L 344,216" fill="none" stroke="black"></path>
                <path d="M 344,264 L 344,360" fill="none" stroke="black"></path>
                <path d="M 376,112 L 376,216" fill="none" stroke="black"></path>
                <path d="M 376,256 L 376,360" fill="none" stroke="black"></path>
                <path d="M 392,80 L 392,112" fill="none" stroke="black"></path>
                <path d="M 392,224 L 392,256" fill="none" stroke="black"></path>
                <path d="M 392,368 L 392,400" fill="none" stroke="black"></path>
                <path d="M 496,64 L 496,416" fill="none" stroke="black"></path>
                <path d="M 152,48 L 304,48" fill="none" stroke="black"></path>
                <path d="M 360,48 L 480,48" fill="none" stroke="black"></path>
                <path d="M 24,80 L 56,80" fill="none" stroke="black"></path>
                <path d="M 152,80 L 240,80" fill="none" stroke="black"></path>
                <path d="M 288,80 L 392,80" fill="none" stroke="black"></path>
                <path d="M 72,96 L 144,96" fill="none" stroke="black"></path>
                <path d="M 240,96 L 280,96" fill="none" stroke="black"></path>
                <path d="M 24,112 L 56,112" fill="none" stroke="black"></path>
                <path d="M 152,112 L 240,112" fill="none" stroke="black"></path>
                <path d="M 288,112 L 392,112" fill="none" stroke="black"></path>
                <path d="M 152,144 L 304,144" fill="none" stroke="black"></path>
                <path d="M 152,192 L 304,192" fill="none" stroke="black"></path>
                <path d="M 24,224 L 40,224" fill="none" stroke="black"></path>
                <path d="M 152,224 L 240,224" fill="none" stroke="black"></path>
                <path d="M 288,224 L 392,224" fill="none" stroke="black"></path>
                <path d="M 64,240 L 152,240" fill="none" stroke="black"></path>
                <path d="M 248,240 L 288,240" fill="none" stroke="black"></path>
                <path d="M 24,256 L 40,256" fill="none" stroke="black"></path>
                <path d="M 152,256 L 240,256" fill="none" stroke="black"></path>
                <path d="M 288,256 L 392,256" fill="none" stroke="black"></path>
                <path d="M 152,288 L 304,288" fill="none" stroke="black"></path>
                <path d="M 152,336 L 304,336" fill="none" stroke="black"></path>
                <path d="M 24,368 L 72,368" fill="none" stroke="black"></path>
                <path d="M 152,368 L 240,368" fill="none" stroke="black"></path>
                <path d="M 288,368 L 392,368" fill="none" stroke="black"></path>
                <path d="M 96,384 L 152,384" fill="none" stroke="black"></path>
                <path d="M 248,384 L 288,384" fill="none" stroke="black"></path>
                <path d="M 24,400 L 72,400" fill="none" stroke="black"></path>
                <path d="M 152,400 L 240,400" fill="none" stroke="black"></path>
                <path d="M 288,400 L 392,400" fill="none" stroke="black"></path>
                <path d="M 152,432 L 304,432" fill="none" stroke="black"></path>
                <path d="M 360,432 L 480,432" fill="none" stroke="black"></path>
                <path d="M 152,48 C 143.16936,48 136,55.16936 136,64" fill="none" stroke="black"></path>
                <path d="M 304,48 C 312.83064,48 320,55.16936 320,64" fill="none" stroke="black"></path>
                <path d="M 360,48 C 351.16936,48 344,55.16936 344,64" fill="none" stroke="black"></path>
                <path d="M 480,48 C 488.83064,48 496,55.16936 496,64" fill="none" stroke="black"></path>
                <path d="M 24,80 C 15.16936,80 8,87.16936 8,96" fill="none" stroke="black"></path>
                <path d="M 56,80 C 64.83064,80 72,87.16936 72,96" fill="none" stroke="black"></path>
                <path d="M 24,112 C 15.16936,112 8,104.83064 8,96" fill="none" stroke="black"></path>
                <path d="M 56,112 C 64.83064,112 72,104.83064 72,96" fill="none" stroke="black"></path>
                <path d="M 152,144 C 143.16936,144 136,136.83064 136,128" fill="none" stroke="black"></path>
                <path d="M 304,144 C 312.83064,144 320,136.83064 320,128" fill="none" stroke="black"></path>
                <path d="M 152,192 C 143.16936,192 136,199.16936 136,208" fill="none" stroke="black"></path>
                <path d="M 304,192 C 312.83064,192 320,199.16936 320,208" fill="none" stroke="black"></path>
                <path d="M 24,224 C 15.16936,224 8,231.16936 8,240" fill="none" stroke="black"></path>
                <path d="M 40,224 C 48.83064,224 56,231.16936 56,240" fill="none" stroke="black"></path>
                <path d="M 24,256 C 15.16936,256 8,248.83064 8,240" fill="none" stroke="black"></path>
                <path d="M 40,256 C 48.83064,256 56,248.83064 56,240" fill="none" stroke="black"></path>
                <path d="M 152,288 C 143.16936,288 136,280.83064 136,272" fill="none" stroke="black"></path>
                <path d="M 304,288 C 312.83064,288 320,280.83064 320,272" fill="none" stroke="black"></path>
                <path d="M 152,336 C 143.16936,336 136,343.16936 136,352" fill="none" stroke="black"></path>
                <path d="M 304,336 C 312.83064,336 320,343.16936 320,352" fill="none" stroke="black"></path>
                <path d="M 24,368 C 15.16936,368 8,375.16936 8,384" fill="none" stroke="black"></path>
                <path d="M 72,368 C 80.83064,368 88,375.16936 88,384" fill="none" stroke="black"></path>
                <path d="M 24,400 C 15.16936,400 8,392.83064 8,384" fill="none" stroke="black"></path>
                <path d="M 72,400 C 80.83064,400 88,392.83064 88,384" fill="none" stroke="black"></path>
                <path d="M 152,432 C 143.16936,432 136,424.83064 136,416" fill="none" stroke="black"></path>
                <path d="M 304,432 C 312.83064,432 320,424.83064 320,416" fill="none" stroke="black"></path>
                <path d="M 360,432 C 351.16936,432 344,424.83064 344,416" fill="none" stroke="black"></path>
                <path d="M 480,432 C 488.83064,432 496,424.83064 496,416" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="384,360 372,354.4 372,365.6" fill="black" transform="rotate(90,376,360)"></polygon>
                <polygon class="arrowhead" points="384,216 372,210.4 372,221.6" fill="black" transform="rotate(90,376,216)"></polygon>
                <polygon class="arrowhead" points="288,96 276,90.4 276,101.6" fill="black" transform="rotate(0,280,96)"></polygon>
                <polygon class="arrowhead" points="256,384 244,378.4 244,389.6" fill="black" transform="rotate(180,248,384)"></polygon>
                <polygon class="arrowhead" points="256,240 244,234.4 244,245.6" fill="black" transform="rotate(180,248,240)"></polygon>
                <polygon class="arrowhead" points="152,96 140,90.4 140,101.6" fill="black" transform="rotate(0,144,96)"></polygon>
                <polygon class="arrowhead" points="104,384 92,378.4 92,389.6" fill="black" transform="rotate(180,96,384)"></polygon>
                <polygon class="arrowhead" points="72,240 60,234.4 60,245.6" fill="black" transform="rotate(180,64,240)"></polygon>
                <g class="text">
                  <text x="40" y="36">Users</text>
                  <text x="188" y="36">Provider</text>
                  <text x="232" y="36">X</text>
                  <text x="380" y="36">Room</text>
                  <text x="416" y="36">123</text>
                  <text x="40" y="100">Alice</text>
                  <text x="188" y="100">Client</text>
                  <text x="224" y="100">A</text>
                  <text x="332" y="100">Server</text>
                  <text x="368" y="100">1</text>
                  <text x="444" y="100">(Follower)</text>
                  <text x="188" y="180">Provider</text>
                  <text x="232" y="180">Y</text>
                  <text x="32" y="244">Bob</text>
                  <text x="188" y="244">Client</text>
                  <text x="224" y="244">B</text>
                  <text x="332" y="244">Server</text>
                  <text x="368" y="244">2</text>
                  <text x="424" y="244">(Hub)</text>
                  <text x="188" y="324">Provider</text>
                  <text x="232" y="324">Z</text>
                  <text x="48" y="388">Charlie</text>
                  <text x="188" y="388">Client</text>
                  <text x="224" y="388">C</text>
                  <text x="332" y="388">Server</text>
                  <text x="368" y="388">3</text>
                  <text x="444" y="388">(Follower)</text>
                </g>
              </svg><a href="#section-5.4-5.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-the-hub-fans-out-messages-t" class="selfRef">The hub fans out messages to participating servers; servers deliver messages to users' clients.</a>
          </figcaption></figure>
</div>
<p id="section-5.4-6">When a client sends a message, the message is delivered to its provider's server
using some provider-internal mechanism.  If the provider is not the hub, then
the server forwards the message to the hub for delivery.  In either case, the
hub distributes the message to all of the servers participating in the room.
Each provider's server then forwards the message to clients of users who are
participating in the room.<a href="#section-5.4-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="actors-identifiers-and-authentication">
<section id="section-6">
      <h2 id="name-actors-identifiers-and-auth">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-actors-identifiers-and-auth" class="section-name selfRef">Actors, Identifiers, and Authentication</a>
      </h2>
<p id="section-6-1">There are several types of entity to be identified in the MIMI system, including:<a href="#section-6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-2.1">
          <p id="section-6-2.1.1">Rooms,<a href="#section-6-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-2.2">
          <p id="section-6-2.2.1">Servers,<a href="#section-6-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-2.3">
          <p id="section-6-2.3.1">Users, and<a href="#section-6-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-2.4">
          <p id="section-6-2.4.1">Clients.<a href="#section-6-2.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-6-3">A server's identity is effectively the identity of the provider it represents.
A room is hosted by a single hub server at a given time, so its identity is
within the scope of the hub server's identity.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">To facilitate the application of policies based on these identifiers to protocol
actions, each actor presents one or more credentials that associate a signature
key pair to their identifiers.  Protocol messages are then signed by their
senders to authenticate the origin of the message.<a href="#section-6-4" class="pilcrow">¶</a></p>
<p id="section-6-5">For a deeper discussion of identity, see <span>[<a href="#I-D.mahy-mimi-identity" class="cite xref">I-D.mahy-mimi-identity</a>]</span>.<a href="#section-6-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">TODO<a href="#section-7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-2.1">
          <p id="section-7-2.1.1">Authorization policy attached to a room<a href="#section-7-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-2.2">
          <p id="section-7-2.2.1">E2E security for messages provided by message delivery protocol<a href="#section-7-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-2.3">
          <p id="section-7-2.3.1">E2E/E2M/M2E/M2M security for events provided by transport protocol<a href="#section-7-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-2.4">
          <p id="section-7-2.4.1">HbH security provided by TLS<a href="#section-7-2.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="iana-considerations">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-8-1">This document has no IANA actions.<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-mimi-content">[I-D.ietf-mimi-content]</dt>
        <dd>
<span class="refAuthor">Mahy, R.</span>, <span class="refTitle">"More Instant Messaging Interoperability (MIMI) message content"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-mimi-content-01</span>, <time datetime="2023-10-23" class="refDate">23 October 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-mimi-content-01">https://datatracker.ietf.org/doc/html/draft-ietf-mimi-content-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.mahy-mimi-identity">[I-D.mahy-mimi-identity]</dt>
      <dd>
<span class="refAuthor">Mahy, R.</span>, <span class="refTitle">"More Instant Messaging Interoperability (MIMI) Identity Concepts"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-mahy-mimi-identity-02</span>, <time datetime="2023-07-10" class="refDate">10 July 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-mahy-mimi-identity-02">https://datatracker.ietf.org/doc/html/draft-mahy-mimi-identity-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">TODO acknowledge.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Richard L. Barnes</span></div>
<div dir="auto" class="left"><span class="org">Cisco</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rlb@ipv.sx" class="email">rlb@ipv.sx</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
